<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<title>Tiled WMS example</title>
    <link href='https://fonts.googleapis.com/css?family=Raleway:400' rel='stylesheet' type='text/css'>

<script src="http://openlayers.org/en/v3.0.0/resources/bootstrap/css/bootstrap-responsive.min.css"></script>
<link rel="stylesheet" href="http://openlayers.org/en/v3.8.2/css/ol.css" type="text/css">
<script src="http://openlayers.org/en/v3.10.1/build/ol.js"></script>
    

<link rel="stylesheet" href="./material.css">
<script src="./material.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
<script type='text/javascript' src='https://code.jquery.com/jquery-1.11.3.min.js'></script>
<script type='text/javascript' src='https://code.jquery.com/ui/1.11.4/jquery-ui.min.js'></script>


    <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
    
<style>
html{ 
    height:100%}
body{font-family: 'Raleway', sans-serif;
    height:100%}
#map{
  height:100%;
  width:100%;
     
}
    .ol-zoom  {
    left: 97%;
        top: 85 %;
        
    }
</style>

<body>

    
  <!-- Uses a header that scrolls with the text, rather than staying
  locked at the top -->
<div class="mdl-layout mdl-js-layout">
  <header class="mdl-layout__header mdl-layout__header--scroll">
    <div class="mdl-layout__header-row">
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
        
    <input class="mdl-textfield__input" type="text" id="sample3" />
    <label style="display:inline-block; " class="mdl-textfield__label" id="sample3">Rechercher dans Montepellier Eve
        </label> 
        
    <input id="track" type="checkbox"/>track position
  </div>
          <img style="display:inline-block; " src="search.png">
    </div>
  </header>
<div style="filter: blur(100px); background: rgba(0, 0, 0,0.8);" id="slidemenu" class="mdl-layout__drawer">
    
    <div style="float: left;text-align:center;" class="span4 offset4">
        <img id="imginfo" style="width:349px;height:200px" src="115058444.jpg">
      
          <span style="font-size: 10px;position:center;color:rgba(255,255,255,0.9)"class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span><br>
<!--        <span class="label label-success">Nom d'événemnt</span>
-->        
        <h4 style="color:rgb(255,255,255);font-family:'Raleway'" id="nom"></h4>
                  <span style="font-size: 10px;position:center;color:rgba(255,255,255,0.9)"class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span><br>
      <div style="float:left;display: inline;">
       
            <h5 class="label label-default" style="text-transform:capitalize;color:rgb(255,255,255);font-family:'Raleway';font-size:14px" id="Commune"></h5>
           <p class="label label-primary" style="width:349px;text-transform:capitalize;color:rgb(255,255,255);font-family:'Raleway';font-size:14px" id="adress"></p>

        </div>

        
        
        
    </div>
    
</div>
 
    <div class="map" id="map"><div id="popup"></div></div>
<!-- <div  style="bottom:100%;"id="infoMove"class="alert alert-info" role="alert"></div> 
-->         
</div>
    
    
    
    
    
    
    
    
    
    
    	

    
    
<script>
    var geometry ;
    var coordinate ;

 var geojsonFormat = new ol.format.GeoJSON();

var vectorSource = new ol.source.Vector({
  loader: function(extent, resolution, projection) {
    var url = 'http://myapp-faisalkanout.rhcloud.com/geoserver/wfs?service=WFS&' +
        'version=1.1.0&request=GetFeature&typename=montpellier:vignobles&' +
        'outputFormat=text/javascript&format_options=callback:loadFeatures' +
        '&srsname=EPSG:3857&bbox=' + extent.join(',') + ',EPSG:3857';
    // use jsonp: false to prevent jQuery from adding the "callback"
    // parameter to the URL
    $.ajax({url: url, dataType: 'jsonp', jsonp: false});
  },
  strategy: ol.loadingstrategy.tile(new ol.tilegrid.createXYZ({
    maxZoom: 13
  }))

});

    // the global function whose name is specified in the URL of JSONP WFS
// GetFeature requests
var loadFeatures = function(response) {
  vectorSource.addFeatures(geojsonFormat.readFeatures(response));
};



// Start Cluster
    
var clusterSource = new ol.source.Cluster({
  distance: 40,
  source: vectorSource
});
        
var styleCache = {};
var clusters = new ol.layer.Vector({
  source: clusterSource,
  style: function(feature, resolution) {
    var size = feature.get('features').length;
    var style = styleCache[size];
    if (!style) {
      style = [new ol.style.Style({
            image: new ol.style.Icon({
          anchor: [0.5, 0.5],
          size: [250, 250],
          offset: [0, 0],
          
          scale: 0.25,
          src: './flags/facebook30.png'
        }),
         
        
        text: new ol.style.Text({
          text: size.toString(),
          font: '12px Calibri,sans-serif',
           offsetX: -15,
            offsetY: -21,
        
          fill: new ol.style.Fill({
            color: '#000000',
              
          })
        })
      })];
      styleCache[size] = style;
    }
    return style;
  }
});
//End Cluster

var slidemenu = document.getElementById('slidemenu');
var source = new ol.source.Vector({
  features: loadFeatures
    });
var styleCache = {};

  
    
    
var openSeaMapLayer = new ol.layer.Tile({
  source: new ol.source.OSM({
    attributions: [
      new ol.Attribution({
        html: 'All maps &copy; ' +
            '<a href="http://www.openseamap.org/">OpenSeaMap</a>'
      }),
      ol.source.OSM.ATTRIBUTION
    ],
    crossOrigin: null,
    url: ' http://tile.openstreetmap.org/{z}/{x}/{y}.png'
  })
});
    
    
var layers = [ 
    openSeaMapLayer,
clusters,
];
var view= new ol.View({
    center:  [431735.4450117468, 5405225.345929167],
    zoom: 9   
    });
var map = new ol.Map({
    layers: layers,
    
    target:    document.getElementById('map'),
    view: view,
    loadTilesWhileAnimating:true,
    loadTilesWhileInteracting:true
    
    });
zoomslider = new ol.control.ZoomSlider();
map.addControl(zoomslider);

    
var nom = document.getElementById('nom');
var place = document.getElementById('Commune');
var imginfo = document.getElementById('imginfo');
var adress = document.getElementById('adress');


    
    
//Start GeoLocalisation
 var geolocation = new ol.Geolocation({
 projection: view.getProjection()
});
function el(id) {
  return document.getElementById(id);
}

el('track').addEventListener('change', function() {
  geolocation.setTracking(this.checked);
});

var accuracyFeature = new ol.Feature();
geolocation.on('change:accuracyGeometry', function() {
  accuracyFeature.setGeometry(geolocation.getAccuracyGeometry());
});

var positionFeature = new ol.Feature();
positionFeature.setStyle(new ol.style.Style({
  image: new ol.style.Circle({
    radius: 6,
    fill: new ol.style.Fill({
      color: '#3399CC'
    }),
    stroke: new ol.style.Stroke({
      color: '#fff',
      width: 2
    })
  })
}));

geolocation.on('change:position', function() {
  var coordinates = geolocation.getPosition();
  positionFeature.setGeometry(coordinates ?
      new ol.geom.Point(coordinates) : null);
});

var featuresOverlay = new ol.layer.Vector({
  map: map,
  source: new ol.source.Vector({
    features: [accuracyFeature, positionFeature]
  })
});
//End GeoLocalisation
   
    
    
map.on('pointermove', function(e) {
  if (e.dragging) {
    $(element).popover('destroy');
    return;
  }
  var pixel = map.getEventPixel(e.originalEvent);
  var hit = map.hasFeatureAtPixel(pixel);
  map.getTarget().style.cursor = hit ? 'pointer' : '';
});

map.on('click', function(evt) {
 
  var feature = map.forEachFeatureAtPixel(evt.pixel, function(feature, layer) {
       geometry = feature.getGeometry();
    return feature;
  });
  if (feature) {
    var features = feature.get('features');
    var i;
    for (i = 0; i < features.length; ++i) {
        nom.innerText=(features[i].get('NOM'));
        place.innerText="Commune: "+(features[i].get('PLACE'));
        imginfo.src="./garig/"+(features[i].get('IMAGE'))+".jpg";
        adress.innerHTML="Adress: "+(features[i].get('ADRESS'));
    }
      slidemenu.className="mdl-layout__drawer is-visible";
  }
    else{
        
         info.innerHTML="";
        place.innerHTML="";
        imginfo.src="";
    }

    coordinate = geometry.getCoordinates();

    //Start Animation 
    var pan = ol.animation.pan({
    duration: 500,
    source: /** @type {ol.Coordinate} */ (view.getCenter())
    });
    map.beforeRender(pan);
    view.setCenter(coordinate);
    //End Animation

    
});

    
</script>

</body>
</html>