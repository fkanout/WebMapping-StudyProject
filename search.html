<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<title>Héraut événement 2016</title>
    <link href='https://fonts.googleapis.com/css?family=Raleway:400' rel='stylesheet' type='text/css'>

<script src="http://openlayers.org/en/v3.0.0/resources/bootstrap/css/bootstrap-responsive.min.css"></script>
<link rel="stylesheet" href="http://openlayers.org/en/v3.8.2/css/ol.css" type="text/css">
<script src="http://openlayers.org/en/v3.10.1/build/ol.js"></script>
    

<link rel="stylesheet" href="./pinmap.css">
    <link rel="stylesheet" href="./material.css">
<script src="./material.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
<script type='text/javascript' src='https://code.jquery.com/jquery-1.11.3.min.js'></script>
<script type='text/javascript' src='https://code.jquery.com/ui/1.11.4/jquery-ui.min.js'></script>


 <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
    <!-- Date picker-->
    <script type='text/javascript' src='http://momentjs.com/downloads/moment-with-locales.js'></script>
    <link rel="stylesheet" href="./bootstrap-material-datetimepicker.css" type="text/css">
    <script src="./bootstrap-material-datetimepicker.js"></script>
    <!-- Date picker-->
<style>
html{ 
    height:100%}
body{font-family: 'Raleway', sans-serif;
    height:100%}
#map{
  height:100%;
  width:100%;
     
}
    .ol-zoom-in, .ol-zoom-out, .ol-zoom {
     visibility: hidden;
        
    left: 50%;
        top: 50%;
        
    }
</style>

<body>

    
  <!-- Uses a header that scrolls with the text, rather than staying
  locked at the top -->
<div class="mdl-layout mdl-js-layout">
<header class="mdl-layout__header mdl-layout__header--scroll">
   
           
<div id="track" style="font-size:12px;cursor:pointer;display:inline-block;position:fixed;top:4%;left:85%;cursor:pointer">
    <div class='pin'></div>
    <div class='pulse'></div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp &nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbsp&nbsp&nbspMe localiser

</div>

            
    
            

<div style="position:fixed;top:15px;left:40%" class="dropdown">
<button style="font-size:12px" class="btn btn-default dropdown-toggle" type="button" id="DM_condition" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
Condition d'entrée
<span class="caret"></span>
</button>
<ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li style="padding:10px;"><label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-1">
<input type="checkbox" id="checkbox-1" class="mdl-checkbox__input" checked>
<span style="font-size:14px;color:rgb(0,0,0)"class="mdl-checkbox__label">Payant</span>
</label></li>
<li style="font-size:12px;padding:10px;"><label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-2">
<input  type="checkbox" id="checkbox-2" class="mdl-checkbox__input" checked>
<span style="font-size:14px;color:rgb(0,0,0)" class="mdl-checkbox__label">Gratuit</span>
</label></li>

</ul>
</div>

        
        <div style="position:fixed;top:15px;left:25%" class="dropdown">
<button style="font-size:12px" class="btn btn-default dropdown-toggle" type="button" id="DM_type" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
Type d'événement
<span class="caret"></span>
</button>
<ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li style="padding:10px;"><label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-1">
<input type="checkbox" id="checkbox-1" class="mdl-checkbox__input" checked>
<span style="font-size:14px;color:rgb(0,0,0)"class="mdl-checkbox__label">Payant</span>
</label></li>
<li style="font-size:12px;padding:10px;"><label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-2">
<input  type="checkbox" id="checkbox-2" class="mdl-checkbox__input" checked>
<span style="font-size:14px;color:rgb(0,0,0)" class="mdl-checkbox__label">Gratuit</span>
</label></li>

</ul>
</div>
        
        
          <div style="position:fixed;top:15px;left:54%" class="dropdown">
<button style="font-size:12px" class="btn btn-default dropdown-toggle" type="button" id="DM_communes" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
Les communes
<span class="caret"></span>
</button>
<ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li style="padding:10px;"><label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-1">
<input type="checkbox" id="checkbox-1" class="mdl-checkbox__input" checked>
<span style="font-size:14px;color:rgb(0,0,0)"class="mdl-checkbox__label">Montpellier</span>
</label></li>
<li style="font-size:12px;padding:10px;"><label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-2">
<input  type="checkbox" id="checkbox-2" class="mdl-checkbox__input" checked>
<span style="font-size:14px;color:rgb(0,0,0)" class="mdl-checkbox__label">Castelnau-le-Lez</span>
</label></li>

</ul>
</div>

            
            <input style="top:1%;text-align:center;position:fixed;font-size:12px;height:20px;width:125px;left:70%" type="text" id="date" class="form-control floating-label" placeholder="Date de debut">
                    
            <input style="top:5%;text-align:center;position:fixed;font-size:12px;height:20px;width:125px;left:70%" type="text" id="date1" class="form-control floating-label" placeholder="Date de fin">
            
            
   
</header>
<div style="text-align: center;filter: blur(100px); background: rgba(0, 0, 0,0.8);" id="slidemenu" class="mdl-layout__drawer">
    

        <img id="imginfo" style="width:349px;height:200px" src="115058444.jpg"> </img>

        <span style="font-size: 10px;position:center;color:rgba(255,255,255,0.9)"class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span>
 <h4 style="color:rgb(255,255,255);font-family:'Raleway'" id="nom"></h4>
      
        <span style="font-size: 10px;position:center;color:rgba(255,255,255,0.9)"class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span>


        <h5 class="" style="background:rgba(239, 239, 239, 0.33);text-transform:capitalize;color:rgb(255,255,255);font-family:'Raleway';font-size:12px" id="Commune"></h5>
      
    
      <h5 class="" style="background:rgba(0, 177, 255, 0);word-break: keep-all;width:349px;text-transform:capitalize;color:rgb(255,255,255);font-family:'Raleway';font-size:12px" id="type"></h5>
     <span style="font-size: 10px;position:center;color:rgba(255,255,255,0.9)"class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span>
    
    
     <h5 class="" style="background:rgba(0,235,255,5);word-break: break-word;width:349px;text-transform:capitalize;color:rgb(255,255,255);font-family:'Raleway';font-size:12px" id="date_d"></h5>
     
      <h5 class="" style="background:rgba(0,235,255,5);word-break: break-word;width:349px;text-transform:capitalize;color:rgb(255,255,255);font-family:'Raleway';font-size:12px" id="date_e"></h5>

    <span style="font-size: 10px;position:center;color:rgba(255,255,255,0.9)"class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span>
    
       <h5 class="" style="background:rgba(95, 255, 89, 0);word-break: break-word;width:349px;text-transform:capitalize;color:rgb(255,255,255);font-family:'Raleway';font-size:12px" id="acces"></h5>
    
       <span style="font-size: 10px;position:center;color:rgba(255,255,255,0.9)"class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span>
    
      <h5 class="" style="background:rgba(0, 177, 255, 0);word-break: keep-all;width:349px;text-transform:capitalize;color:rgb(255,255,255);font-family:'Raleway';font-size:12px" id="adress"></h5>
     <span style="font-size: 10px;position:center;color:rgba(255,255,255,0.9)"class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span>
    
       <h5 class="" style="background:rgba(199, 176, 0, 0);word-break: break-word;width:349px;text-transform:capitalize;color:rgb(255,255,255);font-family:'Raleway';font-size:12px" id="bref"></h5>

  

        
        
        
    
    
</div>
 
    <div class="map" id="map"><div id="popup"></div></div>
<!-- <div  style="bottom:100%;"id="infoMove"class="alert alert-info" role="alert"></div> 
-->         
</div>
    
    
    
    
    
    
    
    
    
    
    	

    
    
<script>
    var geometry ;
    var coordinate ;
var cqlFilter = "ACCES='gratuit'";
 var geojsonFormat = new ol.format.GeoJSON();
    
    var urlTemplate = 'http://myapp-faisalkanout.rhcloud.com/geoserver/wfs?service=WFS&' +
    'version=1.1.0&request=GetFeature&' +
    'typename=montpellier:vignobles&' +
    'CQL_FILTER={{CQLFILTER}}&' +
    'outputFormat=text/javascript&' +
    'format_options=callback:loadFeatures';
 
    
    var vectorSource = new ol.source.Vector({
  loader: function(extent, resolution, projection) {
    var url = urlTemplate.replace('{{CQLFILTER}}', cqlFilter);
    $.ajax({url: url, dataType: 'jsonp', jsonp: false});
  }
});

function changeFilter() {
  cqlFilter = 'ACCES=payant';
  vectorSource.clear(true);
}
    
    
    /*

var vectorSource = new ol.source.Vector({
  loader: function(extent, resolution, projection) {
    var url ="http://myapp-faisalkanout.rhcloud.com/geoserver/wfs?service=WFS&" +
        "version=1.1.0&request=GetFeature&typename=montpellier:vignobles&" +
        "CQL_FILTER='IMAGE>1'&" +
        "outputFormat=text/javascript&format_options=callback:loadFeatures" +
        "&srsname=EPSG:3857&bbox=" + extent.join(',') + ",EPSG:3857";
    // use jsonp: false to prevent jQuery from adding the "callback"
    // parameter to the URL
    $.ajax({url: url, dataType: 'jsonp', jsonp: false});
  },
  strategy: ol.loadingstrategy.tile(new ol.tilegrid.createXYZ({
    maxZoom: 13
  }))

}); */

    // the global function whose name is specified in the URL of JSONP WFS
// GetFeature requests
var loadFeatures = function(response) {
  vectorSource.addFeatures(geojsonFormat.readFeatures(response));
};



// Start Cluster
    
var clusterSource = new ol.source.Cluster({
  distance: 40,
  source: vectorSource
});
        
var styleCache = {};
var clusters = new ol.layer.Vector({
  source: clusterSource,
  style: function(feature, resolution) {
    var size = feature.get('features').length;
    var style = styleCache[size];
    if (!style) {
      style = [new ol.style.Style({
            image: new ol.style.Icon({
          anchor: [0.5, 0.5],
          size: [125, 125],
          offset: [0, 0],
          
          scale: 0.25,
          src: './flags/facebook30.png'
        }),
         
        
        text: new ol.style.Text({
          text: size.toString(),
          font: '12px Calibri,sans-serif',
           offsetX: 0,
            offsetY: -5,
        
          fill: new ol.style.Fill({
            color: '#000000',
              
          })
        })
      })];
      styleCache[size] = style;
    }
    return style;
  }
});
//End Cluster

var slidemenu = document.getElementById('slidemenu');
var source = new ol.source.Vector({
  features: loadFeatures
    });
var styleCache = {};

  
    
    
var openSeaMapLayer = new ol.layer.Tile({
  source: new ol.source.OSM({
    attributions: [
      new ol.Attribution({
        html: 'All maps &copy; ' +
            '<a href="http://www.openseamap.org/">OpenSeaMap</a>'
      }),
      ol.source.OSM.ATTRIBUTION
    ],
    crossOrigin: null,
    url: ' http://tile.openstreetmap.org/{z}/{x}/{y}.png'
  })
});
    
    
var layers = [ 
    openSeaMapLayer,
clusters,
];
var view= new ol.View({
    center:  [431735.4450117468, 5405225.345929167],
    zoom: 9   
    });
var map = new ol.Map({
    layers: layers,
    
    target:    document.getElementById('map'),
    view: view,
    loadTilesWhileAnimating:true,
    loadTilesWhileInteracting:true,
    
    
    });


map.addControl(new ol.control.Zoom({
    className: 'custom-zoom'
}));
   
var nom = document.getElementById('nom');
var place = document.getElementById('Commune');
var imginfo = document.getElementById('imginfo');
var adress = document.getElementById('adress');
var bref = document.getElementById('bref');
var type = document.getElementById('type');
var acces = document.getElementById('acces');
var date_d = document.getElementById('date_d');
var date_e = document.getElementById('date_e');


    
    
//Start GeoLocalisation
 var geolocation = new ol.Geolocation({
 projection: view.getProjection()
});


$( "#track" ).click(function() {
  geolocation.setTracking(true);
});

var accuracyFeature = new ol.Feature();
geolocation.on('change:accuracyGeometry', function() {
  accuracyFeature.setGeometry(geolocation.getAccuracyGeometry());
 
});

var positionFeature = new ol.Feature();
positionFeature.setStyle(new ol.style.Style({
    image: new ol.style.Icon({
          anchor: [0.5, 0.5],
          offset: [0, 0],
                  
          scale: 0.25,
          src: './flags/location.png'
    })
  }));
  
geolocation.on('change:position', function() {
  var coordinates = geolocation.getPosition();

  positionFeature.setGeometry(coordinates ?
      new ol.geom.Point(coordinates) : null);
     
    
});

var featuresOverlay = new ol.layer.Vector({
  map: map,
  source: new ol.source.Vector({
    features: [accuracyFeature, positionFeature]
  })
});

//End GeoLocalisation
   
    
    
map.on('pointermove', function(e) {
  if (e.dragging) {
    $(element).popover('destroy');
    return;
  }
  var pixel = map.getEventPixel(e.originalEvent);
  var hit = map.hasFeatureAtPixel(pixel);
  map.getTarget().style.cursor = hit ? 'pointer' : '';
});

map.on('click', function(evt) {
 
  var feature = map.forEachFeatureAtPixel(evt.pixel, function(feature, layer) {
       geometry = feature.getGeometry();
    return feature;
  });
  if (feature) {
    var features = feature.get('features');
    var i;
    for (i = 0; i < features.length; ++i) {
        nom.innerText=(features[i].get('NOM'));
        place.innerText="Commune: "+(features[i].get('PLACE'));
        imginfo.src="./garig/"+(features[i].get('IMAGE'))+".jpg";
        adress.innerHTML="Adress: <br>"+(features[i].get('ADRESS'));
        bref.innerHTML="Enbref: <br>"+(features[i].get('DESCRIPTIO'));
        type.innerHTML="Type d'evenement: "+(features[i].get('TYPE'));
        acces.innerHTML="Condition d'entrée: "+(features[i].get('ACCES'));
     
        date_d.innerHTML="Date de debut . . . . . ."+(features[i].get('DATE _F'));
        date_e.innerHTML="Date de fin . . . . . . . . . "+(features[i].get('DATE _D'));

       
}
      slidemenu.className="mdl-layout__drawer is-visible";
  }
    else{
        
         info.innerHTML="";
        place.innerHTML="";
        imginfo.src="";
    }

    coordinate = geometry.getCoordinates();

    //Start Animation 
    var pan = ol.animation.pan({
    duration: 500,
    source: /** @type {ol.Coordinate} */ (view.getCenter())
    });
    map.beforeRender(pan);
    view.setCenter(coordinate);
    //End Animation

    
});

</script>
	<script type="text/javascript">
		$(document).ready(function()
		{
			$('#date').bootstrapMaterialDatePicker
			({
				time: false,
                 format : 'DD/MM/YYYY'
			});
           
		});
		</script>
</body>
</html>